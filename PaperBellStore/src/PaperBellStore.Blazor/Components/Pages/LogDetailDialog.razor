@using PaperBellStore.Data

<ModalContent Size="@Size" Class="log-detail-modal">
	<ModalHeader>
		<ModalTitle>日志详情</ModalTitle>
	</ModalHeader>
	<ModalBody Class="log-detail-body">
		<Row>
			<Column ColumnSize="ColumnSize.Is12.OnMobile.Is6.OnDesktop">
				<Text><strong>时间:</strong> @Log.Timestamp.ToString("yyyy-MM-dd HH:mm:ss")</Text>
			</Column>
			<Column ColumnSize="ColumnSize.Is12.OnMobile.Is6.OnDesktop">
				<Text><strong>级别:</strong></Text>
				<Badge Color="@GetLevelColor(Log.Level)">@Log.Level</Badge>
			</Column>
			<Column ColumnSize="ColumnSize.Is12" Class="detail-section">
				<Text><strong>消息:</strong></Text>
				<Card Class="detail-card">
					<CardBody Class="detail-card-body">
						<div class="detail-text">@Log.Message</div>
					</CardBody>
				</Card>
			</Column>
			@if (!string.IsNullOrEmpty(Log.Exception))
			{
				<Column ColumnSize="ColumnSize.Is12" Class="detail-section">
					<Text><strong>异常信息:</strong></Text>
					<Card Class="detail-card">
						<CardBody Class="detail-card-body detail-card-body-mono">
							<div class="detail-text">@Log.Exception</div>
						</CardBody>
					</Card>
				</Column>
			}
			@if (Log.OccurrenceCount > 1)
			{
				<Column ColumnSize="ColumnSize.Is12.OnMobile.Is4.OnDesktop">
					<Text><strong>首次出现:</strong> @Log.FirstOccurrence?.ToString("yyyy-MM-dd HH:mm:ss")</Text>
				</Column>
				<Column ColumnSize="ColumnSize.Is12.OnMobile.Is4.OnDesktop">
					<Text><strong>最后出现:</strong> @Log.LastOccurrence?.ToString("yyyy-MM-dd HH:mm:ss")</Text>
				</Column>
				<Column ColumnSize="ColumnSize.Is12.OnMobile.Is4.OnDesktop">
					<Text><strong>出现次数:</strong></Text>
					<Badge Color="Color.Warning" Pill="true">
						@Log.OccurrenceCount 次
					</Badge>
				</Column>
			}
			@if (!string.IsNullOrEmpty(Log.Properties))
			{
				<Column ColumnSize="ColumnSize.Is12" Class="detail-section">
					<Text><strong>属性 (JSON):</strong></Text>
					<Card Class="detail-card">
						<CardBody Class="detail-card-body detail-card-body-mono">
							<div class="detail-text">@Log.Properties</div>
						</CardBody>
					</Card>
				</Column>
			}
			@if (!string.IsNullOrEmpty(Log.LogEvent))
			{
				<Column ColumnSize="ColumnSize.Is12" Class="detail-section">
					<Text><strong>日志事件 (JSON):</strong></Text>
					<Card Class="detail-card">
						<CardBody Class="detail-card-body detail-card-body-mono">
							<div class="detail-text">@Log.LogEvent</div>
						</CardBody>
					</Card>
				</Column>
			}
		</Row>
	</ModalBody>
	<ModalFooter>
		<Button Color="Color.Secondary" Clicked="@Cancel">关闭</Button>
	</ModalFooter>
</ModalContent>

@code {
	[CascadingParameter] protected ModalInstance ModalInstance { get; set; } = default!;

	[Inject] protected IModalService ModalService { get; set; } = default!;

	[Parameter]
	public AppLog Log { get; set; } = default!;

	[Parameter]
	public ModalSize Size { get; set; } = ModalSize.Default;

	private async Task Cancel()
	{
		if (ModalInstance != null && ModalService != null)
		{
			await ModalService.Hide(ModalInstance);
		}
	}

	private Color GetLevelColor(string? level)
	{
		return level switch
		{
			"Verbose" => Color.Secondary,
			"Debug" => Color.Info,
			"Information" => Color.Primary,
			"Warning" => Color.Warning,
			"Error" => Color.Danger,
			"Fatal" => Color.Dark,
			_ => Color.Secondary
		};
	}
}
