# æ¨¡å—åŒ–é¡¹ç›®ç®¡ç†æ¨¡å—å®æ–½æ­¥éª¤

æœ¬æ–‡æ¡£è¯´æ˜å¦‚ä½•åˆ›å»ºä¸€ä¸ª**ç‹¬ç«‹çš„æ¨¡å—é¡¹ç›®**æ¥å®ç°é¡¹ç›®ç®¡ç†åŠŸèƒ½ï¼Œ**æ— éœ€ä¿®æ”¹**ç°æœ‰çš„åŸºç¡€é¡¹ç›®ä»£ç ã€‚

## ğŸ“‹ æ¶æ„ä¼˜åŠ¿

åˆ›å»ºç‹¬ç«‹æ¨¡å—çš„ä¼˜åŠ¿ï¼š

- âœ… **é›¶ä¾µå…¥**ï¼šä¸ä¿®æ”¹åŸºç¡€é¡¹ç›®ä»£ç 
- âœ… **å¯ç»´æŠ¤**ï¼šåŠŸèƒ½æ¨¡å—ç‹¬ç«‹å¼€å‘å’Œç»´æŠ¤
- âœ… **å¯å¤ç”¨**ï¼šæ¨¡å—å¯åœ¨å…¶ä»–é¡¹ç›®ä¸­å¤ç”¨
- âœ… **æ˜“æµ‹è¯•**ï¼šæ¨¡å—ç‹¬ç«‹æµ‹è¯•
- âœ… **æ˜“å‡çº§**ï¼šåŸºç¡€é¡¹ç›®å‡çº§ä¸å½±å“æ¨¡å—

---

## ğŸ—ï¸ æ¨¡å—é¡¹ç›®ç»“æ„

æˆ‘ä»¬å°†åˆ›å»ºä»¥ä¸‹æ¨¡å—é¡¹ç›®ï¼š

```
src/
  ProjectManagement.Domain.Shared/     # é¢†åŸŸå…±äº«å±‚ï¼ˆå¸¸é‡ã€æšä¸¾ã€DTOæ¥å£ï¼‰
  ProjectManagement.Domain/            # é¢†åŸŸå±‚ï¼ˆå®ä½“ã€ä»“å‚¨æ¥å£ï¼‰
  ProjectManagement.Application.Contracts/  # åº”ç”¨æœåŠ¡å¥‘çº¦å±‚ï¼ˆDTOã€æ¥å£ï¼‰
  ProjectManagement.Application/       # åº”ç”¨å±‚ï¼ˆåº”ç”¨æœåŠ¡å®ç°ï¼‰
  ProjectManagement.EntityFrameworkCore/    # EF Coreå±‚ï¼ˆä»“å‚¨å®ç°ï¼‰
  ProjectManagement.Blazor/            # Blazor UIå±‚ï¼ˆå¯é€‰ï¼‰
```

---

## ç¬¬ä¸€æ­¥ï¼šåˆ›å»ºæ¨¡å—é¡¹ç›®è§£å†³æ–¹æ¡ˆç»“æ„

### 1.1 åˆ›å»ºç›®å½•ç»“æ„

åœ¨è§£å†³æ–¹æ¡ˆçš„ `src` ç›®å½•ä¸‹åˆ›å»ºæ¨¡å—é¡¹ç›®ï¼š

```bash
mkdir src/ProjectManagement.Domain.Shared
mkdir src/ProjectManagement.Domain
mkdir src/ProjectManagement.Application.Contracts
mkdir src/ProjectManagement.Application
mkdir src/ProjectManagement.EntityFrameworkCore
mkdir src/ProjectManagement.Blazor
```

### 1.2 åˆ›å»ºé¡¹ç›®æ–‡ä»¶

#### ProjectManagement.Domain.Shared.csproj

```xml
<Project Sdk="Microsoft.NET.Sdk">
  <Import Project="..\..\common.props" />
  <PropertyGroup>
    <TargetFramework>net9.0</TargetFramework>
    <Nullable>enable</Nullable>
    <RootNamespace>ProjectManagement</RootNamespace>
  </PropertyGroup>
  <ItemGroup>
    <PackageReference Include="Volo.Abp.Core" Version="9.2.1" />
  </ItemGroup>
</Project>
```

#### ProjectManagement.Domain.csproj

```xml
<Project Sdk="Microsoft.NET.Sdk">
  <Import Project="..\..\common.props" />
  <PropertyGroup>
    <TargetFramework>net9.0</TargetFramework>
    <Nullable>enable</Nullable>
    <RootNamespace>ProjectManagement</RootNamespace>
  </PropertyGroup>
  <ItemGroup>
    <ProjectReference Include="..\ProjectManagement.Domain.Shared\ProjectManagement.Domain.Shared.csproj" />
    <ProjectReference Include="..\PaperBellStore.Domain.Shared\PaperBellStore.Domain.Shared.csproj" />
  </ItemGroup>
  <ItemGroup>
    <PackageReference Include="Volo.Abp.Domain" Version="9.2.1" />
  </ItemGroup>
</Project>
```

#### ProjectManagement.Application.Contracts.csproj

```xml
<Project Sdk="Microsoft.NET.Sdk">
  <Import Project="..\..\common.props" />
  <PropertyGroup>
    <TargetFramework>net9.0</TargetFramework>
    <Nullable>enable</Nullable>
    <RootNamespace>ProjectManagement</RootNamespace>
  </PropertyGroup>
  <ItemGroup>
    <ProjectReference Include="..\ProjectManagement.Domain.Shared\ProjectManagement.Domain.Shared.csproj" />
  </ItemGroup>
  <ItemGroup>
    <PackageReference Include="Volo.Abp.Application.Contracts" Version="9.2.1" />
  </ItemGroup>
</Project>
```

#### ProjectManagement.Application.csproj

```xml
<Project Sdk="Microsoft.NET.Sdk">
  <Import Project="..\..\common.props" />
  <PropertyGroup>
    <TargetFramework>net9.0</TargetFramework>
    <Nullable>enable</Nullable>
    <RootNamespace>ProjectManagement</RootNamespace>
  </PropertyGroup>
  <ItemGroup>
    <ProjectReference Include="..\ProjectManagement.Domain\ProjectManagement.Domain.csproj" />
    <ProjectReference Include="..\ProjectManagement.Application.Contracts\ProjectManagement.Application.Contracts.csproj" />
    <ProjectReference Include="..\PaperBellStore.Domain\PaperBellStore.Domain.csproj" />
  </ItemGroup>
  <ItemGroup>
    <PackageReference Include="Volo.Abp.Application" Version="9.2.1" />
    <PackageReference Include="Volo.Abp.AutoMapper" Version="9.2.1" />
    <PackageReference Include="Volo.Abp.Identity.Domain" Version="9.2.1" />
  </ItemGroup>
</Project>
```

#### ProjectManagement.EntityFrameworkCore.csproj

```xml
<Project Sdk="Microsoft.NET.Sdk">
  <Import Project="..\..\common.props" />
  <PropertyGroup>
    <TargetFramework>net9.0</TargetFramework>
    <Nullable>enable</Nullable>
    <RootNamespace>ProjectManagement</RootNamespace>
  </PropertyGroup>
  <ItemGroup>
    <ProjectReference Include="..\ProjectManagement.Domain\ProjectManagement.Domain.csproj" />
    <ProjectReference Include="..\PaperBellStore.EntityFrameworkCore\PaperBellStore.EntityFrameworkCore.csproj" />
  </ItemGroup>
  <ItemGroup>
    <PackageReference Include="Volo.Abp.EntityFrameworkCore" Version="9.2.1" />
    <PackageReference Include="Volo.Abp.EntityFrameworkCore.PostgreSql" Version="9.2.1" />
  </ItemGroup>
</Project>
```

#### ProjectManagement.Blazor.csproj

```xml
<Project Sdk="Microsoft.NET.Sdk.Razor">
  <Import Project="..\..\common.props" />
  <PropertyGroup>
    <TargetFramework>net9.0</TargetFramework>
    <Nullable>enable</Nullable>
    <RootNamespace>ProjectManagement.Blazor</RootNamespace>
  </PropertyGroup>
  <ItemGroup>
    <ProjectReference Include="..\ProjectManagement.Application\ProjectManagement.Application.csproj" />
    <ProjectReference Include="..\ProjectManagement.Application.Contracts\ProjectManagement.Application.Contracts.csproj" />
    <ProjectReference Include="..\PaperBellStore.Blazor\PaperBellStore.Blazor.csproj" />
  </ItemGroup>
  <ItemGroup>
    <PackageReference Include="Volo.Abp.AspNetCore.Components.Server" Version="9.2.1" />
    <PackageReference Include="MudBlazor" Version="7.24.1" />
  </ItemGroup>
</Project>
```

---

## ç¬¬äºŒæ­¥ï¼šDomain.Shared å±‚

### 2.1 åˆ›å»ºå¸¸é‡

**æ–‡ä»¶ä½ç½®**: `src/ProjectManagement.Domain.Shared/ProjectManagementConsts.cs`

```csharp
namespace ProjectManagement;

public static class ProjectManagementConsts
{
    public const string DbTablePrefix = "Pm";
    public const string? DbSchema = null;
}
```

### 2.2 åˆ›å»ºæšä¸¾

**æ–‡ä»¶ä½ç½®**: `src/ProjectManagement.Domain.Shared/Projects/ProjectStatus.cs`

```csharp
namespace ProjectManagement.Projects;

public enum ProjectStatus
{
    Planning = 0,
    InProgress = 1,
    OnHold = 2,
    Completed = 3,
    Cancelled = 4
}
```

---

## ç¬¬ä¸‰æ­¥ï¼šDomain å±‚

### 3.1 åˆ›å»ºå®ä½“

**æ–‡ä»¶ä½ç½®**: `src/ProjectManagement.Domain/Projects/Project.cs`

```csharp
using System;
using Volo.Abp.Domain.Entities.Auditing;
using Volo.Abp.MultiTenancy;

namespace ProjectManagement.Projects;

public class Project : FullAuditedAggregateRoot<Guid>, IMultiTenant
{
    public string Name { get; set; }
    public string Description { get; set; }
    public DateTime StartDate { get; set; }
    public DateTime? EndDate { get; set; }
    public ProjectStatus Status { get; set; }
    public Guid? OwnerId { get; set; }
    public Guid? TenantId { get; set; }

    protected Project()
    {
    }

    public Project(Guid id, string name, string description = null)
        : base(id)
    {
        Name = name;
        Description = description;
        Status = ProjectStatus.Planning;
    }
}
```

### 3.2 åˆ›å»ºä»“å‚¨æ¥å£

**æ–‡ä»¶ä½ç½®**: `src/ProjectManagement.Domain/Projects/IProjectRepository.cs`

```csharp
using System;
using System.Collections.Generic;
using System.Threading;
using System.Threading.Tasks;
using Volo.Abp.Domain.Repositories;

namespace ProjectManagement.Projects;

public interface IProjectRepository : IRepository<Project, Guid>
{
    Task<List<Project>> GetListAsync(
        string sorting = null,
        int maxResultCount = int.MaxValue,
        int skipCount = 0,
        string filter = null,
        CancellationToken cancellationToken = default);

    Task<long> GetCountAsync(
        string filter = null,
        CancellationToken cancellationToken = default);
}
```

### 3.3 åˆ›å»ºé¢†åŸŸæ¨¡å—

**æ–‡ä»¶ä½ç½®**: `src/ProjectManagement.Domain/ProjectManagementDomainModule.cs`

```csharp
using Microsoft.Extensions.DependencyInjection;
using Volo.Abp.Modularity;
using PaperBellStore;

namespace ProjectManagement;

[DependsOn(
    typeof(ProjectManagementDomainSharedModule),
    typeof(PaperBellStoreDomainModule)
)]
public class ProjectManagementDomainModule : AbpModule
{
    public override void ConfigureServices(ServiceConfigurationContext context)
    {
    }
}
```

**æ–‡ä»¶ä½ç½®**: `src/ProjectManagement.Domain.Shared/ProjectManagementDomainSharedModule.cs`

```csharp
using Volo.Abp.Modularity;

namespace ProjectManagement;

public class ProjectManagementDomainSharedModule : AbpModule
{
}
```

---

## ç¬¬å››æ­¥ï¼šApplication.Contracts å±‚

### 4.1 åˆ›å»º DTO

**æ–‡ä»¶ä½ç½®**: `src/ProjectManagement.Application.Contracts/Projects/ProjectDto.cs`

```csharp
using System;
using Volo.Abp.Application.Dtos;

namespace ProjectManagement.Projects;

public class ProjectDto : FullAuditedEntityDto<Guid>
{
    public string Name { get; set; }
    public string Description { get; set; }
    public DateTime StartDate { get; set; }
    public DateTime? EndDate { get; set; }
    public ProjectStatus Status { get; set; }
    public Guid? OwnerId { get; set; }
    public string OwnerName { get; set; }
}
```

**æ–‡ä»¶ä½ç½®**: `src/ProjectManagement.Application.Contracts/Projects/CreateUpdateProjectDto.cs`

```csharp
using System;
using System.ComponentModel.DataAnnotations;

namespace ProjectManagement.Projects;

public class CreateUpdateProjectDto
{
    [Required]
    [StringLength(128)]
    public string Name { get; set; }

    [StringLength(2048)]
    public string Description { get; set; }

    [Required]
    public DateTime StartDate { get; set; }

    public DateTime? EndDate { get; set; }

    public ProjectStatus Status { get; set; } = ProjectStatus.Planning;

    public Guid? OwnerId { get; set; }
}
```

**æ–‡ä»¶ä½ç½®**: `src/ProjectManagement.Application.Contracts/Projects/GetProjectListDto.cs`

```csharp
using Volo.Abp.Application.Dtos;

namespace ProjectManagement.Projects;

public class GetProjectListDto : PagedAndSortedResultRequestDto
{
    public string Filter { get; set; }
    public ProjectStatus? Status { get; set; }
}
```

### 4.2 åˆ›å»ºåº”ç”¨æœåŠ¡æ¥å£

**æ–‡ä»¶ä½ç½®**: `src/ProjectManagement.Application.Contracts/Projects/IProjectAppService.cs`

```csharp
using System;
using Volo.Abp.Application.Dtos;
using Volo.Abp.Application.Services;

namespace ProjectManagement.Projects;

public interface IProjectAppService :
    ICrudAppService<
        ProjectDto,
        Guid,
        GetProjectListDto,
        CreateUpdateProjectDto,
        CreateUpdateProjectDto>
{
}
```

### 4.3 åˆ›å»ºæƒé™å¸¸é‡

**æ–‡ä»¶ä½ç½®**: `src/ProjectManagement.Application.Contracts/Permissions/ProjectManagementPermissions.cs`

```csharp
namespace ProjectManagement.Permissions;

public static class ProjectManagementPermissions
{
    public const string GroupName = "ProjectManagement";

    public const string Default = GroupName;
    public const string Create = Default + ".Create";
    public const string Edit = Default + ".Edit";
    public const string Delete = Default + ".Delete";
    public const string View = Default + ".View";
}
```

### 4.4 åˆ›å»ºæƒé™å®šä¹‰æä¾›ç¨‹åº

**æ–‡ä»¶ä½ç½®**: `src/ProjectManagement.Application.Contracts/Permissions/ProjectManagementPermissionDefinitionProvider.cs`

```csharp
using Volo.Abp.Authorization.Permissions;
using Volo.Abp.Localization;
using ProjectManagement.Localization;

namespace ProjectManagement.Permissions;

public class ProjectManagementPermissionDefinitionProvider : PermissionDefinitionProvider
{
    public override void Define(IPermissionDefinitionContext context)
    {
        var group = context.AddGroup(
            ProjectManagementPermissions.GroupName,
            L("Permission:ProjectManagement"));

        group.AddPermission(
            ProjectManagementPermissions.Default,
            L("Permission:ProjectManagement"));

        group.AddPermission(
            ProjectManagementPermissions.Create,
            L("Permission:ProjectManagement.Create"));

        group.AddPermission(
            ProjectManagementPermissions.Edit,
            L("Permission:ProjectManagement.Edit"));

        group.AddPermission(
            ProjectManagementPermissions.Delete,
            L("Permission:ProjectManagement.Delete"));

        group.AddPermission(
            ProjectManagementPermissions.View,
            L("Permission:ProjectManagement.View"));
    }

    private static LocalizableString L(string name)
    {
        return LocalizableString.Create<ProjectManagementResource>(name);
    }
}
```

### 4.5 åˆ›å»ºæœ¬åœ°åŒ–èµ„æºç±»

**æ–‡ä»¶ä½ç½®**: `src/ProjectManagement.Domain.Shared/Localization/ProjectManagementResource.cs`

```csharp
using Volo.Abp.Localization;

namespace ProjectManagement.Localization;

[LocalizationResourceName("ProjectManagement")]
public class ProjectManagementResource
{
}
```

**æ–‡ä»¶ä½ç½®**: `src/ProjectManagement.Domain.Shared/Localization/ProjectManagement/zh-Hans.json`

```json
{
  "culture": "zh-Hans",
  "texts": {
    "Permission:ProjectManagement": "é¡¹ç›®ç®¡ç†",
    "Permission:ProjectManagement.Create": "åˆ›å»ºé¡¹ç›®",
    "Permission:ProjectManagement.Edit": "ç¼–è¾‘é¡¹ç›®",
    "Permission:ProjectManagement.Delete": "åˆ é™¤é¡¹ç›®",
    "Permission:ProjectManagement.View": "æŸ¥çœ‹é¡¹ç›®",
    "Menu:ProjectManagement": "é¡¹ç›®ç®¡ç†"
  }
}
```

### 4.6 åˆ›å»ºåº”ç”¨æœåŠ¡å¥‘çº¦æ¨¡å—

**æ–‡ä»¶ä½ç½®**: `src/ProjectManagement.Application.Contracts/ProjectManagementApplicationContractsModule.cs`

```csharp
using Volo.Abp.Modularity;
using ProjectManagement;

namespace ProjectManagement;

[DependsOn(
    typeof(ProjectManagementDomainSharedModule)
)]
public class ProjectManagementApplicationContractsModule : AbpModule
{
}
```

---

## ç¬¬äº”æ­¥ï¼šApplication å±‚

### 5.1 åˆ›å»ºåº”ç”¨æœåŠ¡å®ç°

**æ–‡ä»¶ä½ç½®**: `src/ProjectManagement.Application/Projects/ProjectAppService.cs`

```csharp
using System;
using System.Linq;
using System.Threading.Tasks;
using Microsoft.AspNetCore.Authorization;
using ProjectManagement.Permissions;
using ProjectManagement.Projects;
using Volo.Abp.Application.Dtos;
using Volo.Abp.Application.Services;
using Volo.Abp.Domain.Repositories;
using Volo.Abp.Identity;

namespace ProjectManagement.Projects;

[Authorize(ProjectManagementPermissions.Default)]
public class ProjectAppService :
    CrudAppService<
        Project,
        ProjectDto,
        Guid,
        GetProjectListDto,
        CreateUpdateProjectDto,
        CreateUpdateProjectDto>,
    IProjectAppService
{
    private readonly IIdentityUserRepository _userRepository;

    public ProjectAppService(
        IRepository<Project, Guid> repository,
        IIdentityUserRepository userRepository)
        : base(repository)
    {
        _userRepository = userRepository;
        GetPolicyName = ProjectManagementPermissions.View;
        GetListPolicyName = ProjectManagementPermissions.View;
        CreatePolicyName = ProjectManagementPermissions.Create;
        UpdatePolicyName = ProjectManagementPermissions.Edit;
        DeletePolicyName = ProjectManagementPermissions.Delete;
    }

    protected override async Task<ProjectDto> MapToGetOutputDtoAsync(Project entity)
    {
        var dto = await base.MapToGetOutputDtoAsync(entity);

        if (entity.OwnerId.HasValue)
        {
            var owner = await _userRepository.GetAsync(entity.OwnerId.Value);
            dto.OwnerName = owner.UserName;
        }

        return dto;
    }

    protected override async Task<IQueryable<Project>> CreateFilteredQueryAsync(GetProjectListDto input)
    {
        var queryable = await base.CreateFilteredQueryAsync(input);

        if (!string.IsNullOrWhiteSpace(input.Filter))
        {
            queryable = queryable.Where(x =>
                x.Name.Contains(input.Filter) ||
                (x.Description != null && x.Description.Contains(input.Filter)));
        }

        if (input.Status.HasValue)
        {
            queryable = queryable.Where(x => x.Status == input.Status.Value);
        }

        return queryable;
    }
}
```

### 5.2 é…ç½® AutoMapper

**æ–‡ä»¶ä½ç½®**: `src/ProjectManagement.Application/ProjectManagementApplicationAutoMapperProfile.cs`

```csharp
using AutoMapper;
using ProjectManagement.Projects;

namespace ProjectManagement;

public class ProjectManagementApplicationAutoMapperProfile : Profile
{
    public ProjectManagementApplicationAutoMapperProfile()
    {
        CreateMap<Project, ProjectDto>();
        CreateMap<CreateUpdateProjectDto, Project>();
    }
}
```

### 5.3 åˆ›å»ºåº”ç”¨æ¨¡å—

**æ–‡ä»¶ä½ç½®**: `src/ProjectManagement.Application/ProjectManagementApplicationModule.cs`

```csharp
using Microsoft.Extensions.DependencyInjection;
using Volo.Abp.AutoMapper;
using Volo.Abp.Modularity;
using Volo.Abp.Application;
using Volo.Abp.Identity;
using PaperBellStore;

namespace ProjectManagement;

[DependsOn(
    typeof(ProjectManagementDomainModule),
    typeof(ProjectManagementApplicationContractsModule),
    typeof(AbpApplicationModule),
    typeof(AbpIdentityDomainModule),
    typeof(PaperBellStoreApplicationModule)
)]
public class ProjectManagementApplicationModule : AbpModule
{
    public override void ConfigureServices(ServiceConfigurationContext context)
    {
        Configure<AbpAutoMapperOptions>(options =>
        {
            options.AddMaps<ProjectManagementApplicationModule>();
        });
    }
}
```

---

## ç¬¬å…­æ­¥ï¼šEntityFrameworkCore å±‚

### 6.1 å®ç°ä»“å‚¨

**æ–‡ä»¶ä½ç½®**: `src/ProjectManagement.EntityFrameworkCore/Projects/ProjectRepository.cs`

```csharp
using System;
using System.Collections.Generic;
using System.Linq;
using System.Linq.Dynamic.Core;
using System.Threading;
using System.Threading.Tasks;
using Microsoft.EntityFrameworkCore;
using ProjectManagement.Projects;
using Volo.Abp.Domain.Repositories.EntityFrameworkCore;
using Volo.Abp.EntityFrameworkCore;
using PaperBellStore.EntityFrameworkCore;

namespace ProjectManagement.EntityFrameworkCore.Projects;

public class ProjectRepository :
    EfCoreRepository<PaperBellStoreDbContext, Project, Guid>,
    IProjectRepository
{
    public ProjectRepository(
        IDbContextProvider<PaperBellStoreDbContext> dbContextProvider)
        : base(dbContextProvider)
    {
    }

    public async Task<List<Project>> GetListAsync(
        string sorting = null,
        int maxResultCount = int.MaxValue,
        int skipCount = 0,
        string filter = null,
        CancellationToken cancellationToken = default)
    {
        var query = await GetQueryableAsync();

        if (!string.IsNullOrWhiteSpace(filter))
        {
            query = query.Where(x =>
                x.Name.Contains(filter) ||
                (x.Description != null && x.Description.Contains(filter)));
        }

        query = string.IsNullOrWhiteSpace(sorting)
            ? query.OrderByDescending(x => x.CreationTime)
            : query.OrderBy(sorting);

        return await query
            .Skip(skipCount)
            .Take(maxResultCount)
            .ToListAsync(cancellationToken);
    }

    public async Task<long> GetCountAsync(
        string filter = null,
        CancellationToken cancellationToken = default)
    {
        var query = await GetQueryableAsync();

        if (!string.IsNullOrWhiteSpace(filter))
        {
            query = query.Where(x =>
                x.Name.Contains(filter) ||
                (x.Description != null && x.Description.Contains(filter)));
        }

        return await query.LongCountAsync(cancellationToken);
    }
}
```

### 6.2 é…ç½®å®ä½“æ˜ å°„ï¼ˆåœ¨ä¸»é¡¹ç›®çš„ DbContext ä¸­ï¼‰

ç”±äºæˆ‘ä»¬è¦ä½¿ç”¨ä¸»é¡¹ç›®çš„ DbContextï¼Œéœ€è¦åœ¨ä¸»é¡¹ç›®çš„ `PaperBellStoreDbContext` ä¸­æ·»åŠ é¡¹ç›®å®ä½“ï¼š

**ä¿®æ”¹**: `src/PaperBellStore.EntityFrameworkCore/EntityFrameworkCore/PaperBellStoreDbContext.cs`

```csharp
using ProjectManagement.Projects;

public class PaperBellStoreDbContext : AbpDbContext<PaperBellStoreDbContext>
{
    // ... ç°æœ‰ä»£ç  ...

    // æ·»åŠ é¡¹ç›®ç®¡ç†çš„DbSet
    public DbSet<Project> Projects { get; set; }
}
```

åœ¨ `OnModelCreating` æ–¹æ³•ä¸­é…ç½®ï¼š

```csharp
protected override void OnModelCreating(ModelBuilder builder)
{
    base.OnModelCreating(builder);

    // ... ç°æœ‰é…ç½® ...

    // é…ç½®é¡¹ç›®ç®¡ç†å®ä½“
    builder.Entity<Project>(b =>
    {
        b.ToTable(ProjectManagementConsts.DbTablePrefix + "Projects", ProjectManagementConsts.DbSchema);
        b.ConfigureByConvention();

        b.Property(x => x.Name).IsRequired().HasMaxLength(128);
        b.Property(x => x.Description).HasMaxLength(2048);

        b.HasIndex(x => x.Name);
    });
}
```

### 6.3 åˆ›å»º EF Core æ¨¡å—

**æ–‡ä»¶ä½ç½®**: `src/ProjectManagement.EntityFrameworkCore/ProjectManagementEntityFrameworkCoreModule.cs`

```csharp
using Microsoft.Extensions.DependencyInjection;
using Volo.Abp.EntityFrameworkCore;
using Volo.Abp.Modularity;
using ProjectManagement.Projects;
using ProjectManagement.EntityFrameworkCore.Projects;
using PaperBellStore.EntityFrameworkCore;

namespace ProjectManagement.EntityFrameworkCore;

[DependsOn(
    typeof(ProjectManagementDomainModule),
    typeof(ProjectManagementApplicationModule),
    typeof(PaperBellStoreEntityFrameworkCoreModule)
)]
public class ProjectManagementEntityFrameworkCoreModule : AbpModule
{
    public override void ConfigureServices(ServiceConfigurationContext context)
    {
        context.Services.AddAbpDbContext<PaperBellStoreDbContext>(options =>
        {
            // æ·»åŠ é¡¹ç›®ç®¡ç†çš„ä»“å‚¨
            options.AddRepository<Project, ProjectRepository>();
        });
    }
}
```

---

## ç¬¬ä¸ƒæ­¥ï¼šBlazor UI å±‚ï¼ˆå¯é€‰ï¼‰

### 7.1 åˆ›å»º Blazor æ¨¡å—

**æ–‡ä»¶ä½ç½®**: `src/ProjectManagement.Blazor/ProjectManagementBlazorModule.cs`

```csharp
using Microsoft.Extensions.DependencyInjection;
using Volo.Abp.Modularity;
using Volo.Abp.UI.Navigation;
using ProjectManagement.Blazor.Menus;
using ProjectManagement.Application;
using ProjectManagement.Application.Contracts;
using PaperBellStore.Blazor;

namespace ProjectManagement.Blazor;

[DependsOn(
    typeof(ProjectManagementApplicationModule),
    typeof(ProjectManagementApplicationContractsModule),
    typeof(PaperBellStoreBlazorModule)
)]
public class ProjectManagementBlazorModule : AbpModule
{
    public override void ConfigureServices(ServiceConfigurationContext context)
    {
        Configure<AbpNavigationOptions>(options =>
        {
            options.MenuContributors.Add(new ProjectManagementMenuContributor());
        });
    }
}
```

### 7.2 åˆ›å»ºèœå•è´¡çŒ®è€…

**æ–‡ä»¶ä½ç½®**: `src/ProjectManagement.Blazor/Menus/ProjectManagementMenuContributor.cs`

```csharp
using System.Threading.Tasks;
using ProjectManagement.Localization;
using ProjectManagement.Permissions;
using Volo.Abp.UI.Navigation;

namespace ProjectManagement.Blazor.Menus;

public class ProjectManagementMenuContributor : IMenuContributor
{
    public async Task ConfigureMenuAsync(MenuConfigurationContext context)
    {
        if (context.Menu.Name == StandardMenus.Main)
        {
            await ConfigureMainMenuAsync(context);
        }
    }

    private Task ConfigureMainMenuAsync(MenuConfigurationContext context)
    {
        var l = context.GetLocalizer<ProjectManagementResource>();

        context.Menu.AddItem(
            new ApplicationMenuItem(
                "ProjectManagement",
                l["Menu:ProjectManagement"],
                "/projects",
                icon: "fas fa-project-diagram",
                order: 2,
                requiredPermissionName: ProjectManagementPermissions.Default
            )
        );

        return Task.CompletedTask;
    }
}
```

### 7.3 åˆ›å»ºé¡µé¢

**æ–‡ä»¶ä½ç½®**: `src/ProjectManagement.Blazor/Pages/Projects/Index.razor`

ï¼ˆé¡µé¢ä»£ç ä¸ä¹‹å‰æ–‡æ¡£ä¸­çš„ç›¸åŒï¼Œè¿™é‡Œçœç•¥ï¼‰

### 7.4 åˆ›å»ºç»„ä»¶åŸºç±»

**æ–‡ä»¶ä½ç½®**: `src/ProjectManagement.Blazor/ProjectManagementComponentBase.cs`

```csharp
using ProjectManagement.Localization;
using Volo.Abp.AspNetCore.Components.Web.Theming;

namespace ProjectManagement.Blazor;

public abstract class ProjectManagementComponentBase : AbpComponentBase
{
    protected ProjectManagementComponentBase()
    {
        LocalizationResource = typeof(ProjectManagementResource);
    }
}
```

---

## ç¬¬å…«æ­¥ï¼šåœ¨ä¸»é¡¹ç›®ä¸­å¼•ç”¨æ¨¡å—

### 8.1 æ·»åŠ é¡¹ç›®å¼•ç”¨åˆ°è§£å†³æ–¹æ¡ˆ

ä¿®æ”¹ `PaperBellStore.sln`ï¼Œæ·»åŠ æ¨¡å—é¡¹ç›®ï¼š

```xml
Project("{FAE04EC0-301F-11D3-BF4B-00C04F79EFBC}") = "ProjectManagement.Domain.Shared", "src\ProjectManagement.Domain.Shared\ProjectManagement.Domain.Shared.csproj", "{GUID1}"
EndProject
Project("{FAE04EC0-301F-11D3-BF4B-00C04F79EFBC}") = "ProjectManagement.Domain", "src\ProjectManagement.Domain\ProjectManagement.Domain.csproj", "{GUID2}"
EndProject
Project("{FAE04EC0-301F-11D3-BF4B-00C04F79EFBC}") = "ProjectManagement.Application.Contracts", "src\ProjectManagement.Application.Contracts\ProjectManagement.Application.Contracts.csproj", "{GUID3}"
EndProject
Project("{FAE04EC0-301F-11D3-BF4B-00C04F79EFBC}") = "ProjectManagement.Application", "src\ProjectManagement.Application\ProjectManagement.Application.csproj", "{GUID4}"
EndProject
Project("{FAE04EC0-301F-11D3-BF4B-00C04F79EFBC}") = "ProjectManagement.EntityFrameworkCore", "src\ProjectManagement.EntityFrameworkCore\ProjectManagement.EntityFrameworkCore.csproj", "{GUID5}"
EndProject
Project("{FAE04EC0-301F-11D3-BF4B-00C04F79EFBC}") = "ProjectManagement.Blazor", "src\ProjectManagement.Blazor\ProjectManagement.Blazor.csproj", "{GUID6}"
EndProject
```

### 8.2 åœ¨ä¸»é¡¹ç›®ä¸­æ·»åŠ æ¨¡å—ä¾èµ–

**ä¿®æ”¹**: `src/PaperBellStore.Blazor/PaperBellStoreBlazorModule.cs`

```csharp
using ProjectManagement.Blazor;

[DependsOn(
    typeof(PaperBellStoreApplicationModule),
    // ... å…¶ä»–ä¾èµ– ...
    typeof(ProjectManagementBlazorModule)  // æ·»åŠ è¿™è¡Œ
)]
public class PaperBellStoreBlazorModule : AbpModule
{
    // ...
}
```

**ä¿®æ”¹**: `src/PaperBellStore.EntityFrameworkCore/EntityFrameworkCore/PaperBellStoreEntityFrameworkCoreModule.cs`

```csharp
using ProjectManagement.EntityFrameworkCore;

[DependsOn(
    typeof(PaperBellStoreDomainModule),
    // ... å…¶ä»–ä¾èµ– ...
    typeof(ProjectManagementEntityFrameworkCoreModule)  // æ·»åŠ è¿™è¡Œ
)]
public class PaperBellStoreEntityFrameworkCoreModule : AbpModule
{
    // ...
}
```

### 8.3 åœ¨ä¸»é¡¹ç›®çš„ DbContext ä¸­æ·»åŠ å®ä½“æ˜ å°„

**ä¿®æ”¹**: `src/PaperBellStore.EntityFrameworkCore/EntityFrameworkCore/PaperBellStoreDbContext.cs`

```csharp
using ProjectManagement.Projects;

public class PaperBellStoreDbContext : AbpDbContext<PaperBellStoreDbContext>
{
    // æ·»åŠ é¡¹ç›®ç®¡ç†å®ä½“
    public DbSet<Project> Projects { get; set; }

    protected override void OnModelCreating(ModelBuilder builder)
    {
        base.OnModelCreating(builder);

        // ... ç°æœ‰é…ç½® ...

        // é…ç½®é¡¹ç›®ç®¡ç†å®ä½“
        builder.Entity<Project>(b =>
        {
            b.ToTable(ProjectManagementConsts.DbTablePrefix + "Projects", ProjectManagementConsts.DbSchema);
            b.ConfigureByConvention();
            b.Property(x => x.Name).IsRequired().HasMaxLength(128);
            b.Property(x => x.Description).HasMaxLength(2048);
            b.HasIndex(x => x.Name);
        });
    }
}
```

### 8.4 åœ¨ä¸»é¡¹ç›®çš„ Blazor é¡¹ç›®ä¸­æ·»åŠ è·¯ç”±

**ä¿®æ”¹**: `src/PaperBellStore.Blazor/Program.cs` æˆ– `_Imports.razor`

ç¡®ä¿ä¸»é¡¹ç›®çš„ Blazor åº”ç”¨èƒ½å¤Ÿå‘ç°æ¨¡å—çš„è·¯ç”±ã€‚

---

## ç¬¬ä¹æ­¥ï¼šæ•°æ®åº“è¿ç§»

### 9.1 ç”Ÿæˆè¿ç§»

åœ¨ä¸»é¡¹ç›® DbContext æ‰€åœ¨çš„ EntityFrameworkCore é¡¹ç›®ç›®å½•ä¸‹è¿è¡Œï¼š

```bash
dotnet ef migrations add "Added_ProjectManagement_Module" --project src/PaperBellStore.EntityFrameworkCore --startup-project src/PaperBellStore.DbMigrator
```

### 9.2 åº”ç”¨è¿ç§»

```bash
dotnet run --project src/PaperBellStore.DbMigrator
```

---

## ç¬¬åæ­¥ï¼šé…ç½®æœ¬åœ°åŒ–èµ„æº

åœ¨ä¸»é¡¹ç›®çš„æœ¬åœ°åŒ–èµ„æºé…ç½®ä¸­æ·»åŠ æ¨¡å—çš„èµ„æºï¼š

**ä¿®æ”¹**: `src/PaperBellStore.Blazor/PaperBellStoreBlazorModule.cs`

```csharp
public override void PreConfigureServices(ServiceConfigurationContext context)
{
    context.Services.PreConfigure<AbpMvcDataAnnotationsLocalizationOptions>(options =>
    {
        options.AddAssemblyResource(
            typeof(PaperBellStoreResource),
            typeof(PaperBellStoreDomainModule).Assembly,
            typeof(PaperBellStoreDomainSharedModule).Assembly,
            typeof(PaperBellStoreApplicationModule).Assembly,
            typeof(PaperBellStoreApplicationContractsModule).Assembly,
            typeof(PaperBellStoreBlazorModule).Assembly,
            typeof(ProjectManagementResource).Assembly  // æ·»åŠ è¿™è¡Œ
        );
    });
}
```

---

## âœ… æ£€æŸ¥æ¸…å•

- [ ] 1. åˆ›å»ºæ‰€æœ‰æ¨¡å—é¡¹ç›®æ–‡ä»¶
- [ ] 2. æ·»åŠ é¡¹ç›®åˆ°è§£å†³æ–¹æ¡ˆ
- [ ] 3. é…ç½®å„å±‚æ¨¡å—ä¾èµ–å…³ç³»
- [ ] 4. åœ¨ä¸»é¡¹ç›®ä¸­æ·»åŠ æ¨¡å—ä¾èµ–
- [ ] 5. åœ¨ä¸»é¡¹ç›® DbContext ä¸­é…ç½®å®ä½“
- [ ] 6. ç”Ÿæˆå¹¶è¿è¡Œæ•°æ®åº“è¿ç§»
- [ ] 7. é…ç½®æœ¬åœ°åŒ–èµ„æº
- [ ] 8. æµ‹è¯•æ¨¡å—åŠŸèƒ½

---

## ğŸ“ æ³¨æ„äº‹é¡¹

1. **DbContext å…±äº«**: æ¨¡å—ä½¿ç”¨ä¸»é¡¹ç›®çš„ DbContextï¼Œæ‰€ä»¥å®ä½“æ˜ å°„éœ€è¦åœ¨ä¸»é¡¹ç›®ä¸­é…ç½®ï¼ˆè¿™æ˜¯å”¯ä¸€éœ€è¦ä¿®æ”¹ä¸»é¡¹ç›®çš„åœ°æ–¹ï¼‰
2. **å‘½åç©ºé—´**: ç¡®ä¿æ¨¡å—çš„å‘½åç©ºé—´ç‹¬ç«‹ï¼Œé¿å…å†²çª
3. **è¡¨å‰ç¼€**: ä½¿ç”¨ `ProjectManagementConsts.DbTablePrefix` ç¡®ä¿è¡¨åä¸å†²çª
4. **ä¾èµ–æ–¹å‘**: æ¨¡å—ä¾èµ–ä¸»é¡¹ç›®ï¼Œä¸»é¡¹ç›®å¼•ç”¨æ¨¡å—ï¼Œå½¢æˆæ¨¡å—åŒ–æ¶æ„

---

## ğŸ¯ ä¼˜åŠ¿æ€»ç»“

é‡‡ç”¨æ¨¡å—åŒ–å¼€å‘æ–¹å¼çš„å¥½å¤„ï¼š

- âœ… åŸºç¡€é¡¹ç›®ä»£ç ä¿æŒå¹²å‡€
- âœ… æ¨¡å—åŠŸèƒ½ç‹¬ç«‹å¼€å‘å’Œæµ‹è¯•
- âœ… æ˜“äºç‰ˆæœ¬ç®¡ç†å’Œå‡çº§
- âœ… å¯ä»¥åœ¨å¤šä¸ªé¡¹ç›®ä¸­å¤ç”¨æ¨¡å—
- âœ… å›¢é˜Ÿæˆå‘˜å¯ä»¥å¹¶è¡Œå¼€å‘ä¸åŒæ¨¡å—
